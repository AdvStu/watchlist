<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ANPR Watchlist</title>
  </head>
  <body>
    <h1>ANPR Watchlist</h1>
    <form id="watchlist-form">
      <label for="tenant-id">Tenant ID:</label>
      <input type="text" id="tenant-id" name="tenantId" required /><br />
      <label for="license-plate">License plate:</label>
      <input type="text" id="license-plate" name="licensePlate" required /><br />
      <button type="submit">Add to watchlist</button>
    </form>
    <table id="watchlist-table">
      <thead>
        <tr>
          <th>Tenant ID</th>
          <th>License Plate</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      const watchlistForm = document.getElementById('watchlist-form');
      const watchlistTableBody = document.querySelector('#watchlist-table tbody');

      // Add a new watchlist entry when the form is submitted
      watchlistForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const formData = new FormData(watchlistForm);
        const response = await fetch('/api/watchlist', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(Object.fromEntries(formData)),
        });
        if (response.ok) {
          alert('Watchlist entry added!');
        } else {
          const data = await response.json();
          alert(`Failed to add watchlist entry: ${data.error}`);
        }
      });

      // Load all watchlist entries for a tenant when the page loads
      window.addEventListener('load', async () => {
        const tenantId = new URLSearchParams(window.location.search).get('tenantId');
        if (!tenantId) {
          return;
        }
        const response = await fetch(`/api/watchlist/${tenantId}`);
        if (response.ok) {
          const watchlistEntries = await response.json();
          for (const entry of watchlistEntries) {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${entry.tenantId}</td><td>${entry.licensePlate}</td>`;
            watchlistTableBody.appendChild(row);
          }
        } else {
          const data = await response.json();
          alert(`Failed to load watchlist entries: ${data.error}`);
        }
      });
    </script>
  </body>
</html>
